Index: app/src/main/java/com/example/shroomies/LoginActivity.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.example.shroomies;\r\n\r\nimport android.content.Intent;\r\nimport android.os.Bundle;\r\n\r\nimport android.text.TextUtils;\r\nimport android.util.Log;\r\nimport android.view.View;\r\nimport android.widget.Button;\r\nimport android.widget.EditText;\r\nimport android.widget.TextView;\r\nimport android.widget.Toast;\r\n\r\nimport androidx.annotation.NonNull;\r\nimport androidx.appcompat.app.AppCompatActivity;\r\nimport androidx.biometric.BiometricConstants;\r\nimport androidx.biometric.BiometricPrompt;\r\nimport androidx.core.content.ContextCompat;\r\n\r\nimport com.google.android.gms.auth.api.signin.GoogleSignIn;\r\nimport com.google.android.gms.auth.api.signin.GoogleSignInAccount;\r\nimport com.google.android.gms.auth.api.signin.GoogleSignInClient;\r\nimport com.google.android.gms.auth.api.signin.GoogleSignInOptions;\r\nimport com.google.android.gms.common.api.ApiException;\r\nimport com.google.android.gms.tasks.OnCompleteListener;\r\nimport com.google.android.gms.tasks.OnFailureListener;\r\nimport com.google.android.gms.tasks.Task;\r\nimport com.google.firebase.auth.AuthCredential;\r\nimport com.google.firebase.auth.AuthResult;\r\nimport com.google.firebase.auth.FirebaseAuth;\r\nimport com.google.firebase.auth.FirebaseAuthInvalidCredentialsException;\r\nimport com.google.firebase.auth.FirebaseAuthInvalidUserException;\r\nimport com.google.firebase.auth.FirebaseUser;\r\nimport com.google.firebase.auth.GoogleAuthProvider;\r\n\r\nimport java.io.File;\r\nimport java.util.concurrent.Executor;\r\n\r\npublic class LoginActivity extends AppCompatActivity {\r\n    protected EditText username;\r\n    protected EditText password;\r\n    Button login, google_sign;\r\n    TextView signup;\r\n\r\n    private final int RC_SIGN_IN = 7;\r\n    GoogleSignInClient mGoogleSignInClient;\r\n    FirebaseAuth mAuth;\r\n\r\n    SessionManager sessionManager;\r\n    boolean successBiometric = false;\r\n    static String user;\r\n    private Executor executor;\r\n    private BiometricPrompt biometricPrompt;\r\n    private BiometricPrompt.PromptInfo promptInfo;\r\n    boolean alredyLoggedin = false;\r\n\r\n    @Override\r\n    protected void onCreate(Bundle savedInstanceState) {\r\n        super.onCreate(savedInstanceState);\r\n        try {\r\n            File root = new File(\"/data/data/com.example.Shroomies/shared_prefs\");\r\n            if (root.isDirectory()) {\r\n                for (File child : root.listFiles()) {\r\n                    String fileName = child.getPath().substring(48).split(\"\\\\.\")[0];\r\n                    SessionManager sessionManager = new SessionManager(LoginActivity.this, fileName);\r\n                    if (sessionManager.isLoggedIn()) {\r\n                        this.user = fileName;\r\n                        alredyLoggedin = true;\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n        } catch (Exception e) {\r\n        }\r\n        if (alredyLoggedin) {\r\n            startActivity(new Intent(this, MainActivity.class));\r\n            finish();\r\n            Toast.makeText(LoginActivity.this, \"logged in as \" + user, Toast.LENGTH_LONG).show();\r\n        }\r\n\r\n        setContentView(R.layout.activity_login);\r\n        username = findViewById(R.id.email_login);\r\n        password = findViewById(R.id.password_login);\r\n        login = findViewById(R.id.login_button);\r\n        signup = findViewById(R.id.sign_up_button);\r\n        google_sign = findViewById(R.id.google_sign_up);\r\n        mAuth = FirebaseAuth.getInstance();\r\n\r\n        signup.setOnClickListener(new View.OnClickListener() {\r\n            @Override\r\n            public void onClick(View v) {\r\n                Intent intent = new Intent(getApplication(), SignUpActivity.class);\r\n                startActivity(intent);\r\n            }\r\n        });\r\n\r\n        GoogleSignInOptions gso = new GoogleSignInOptions.Builder(GoogleSignInOptions.DEFAULT_SIGN_IN)\r\n                .requestIdToken(getString(R.string.default_web_client_id))\r\n                .requestEmail()\r\n                .build();\r\n\r\n        mGoogleSignInClient = GoogleSignIn.getClient(this, gso);\r\n        google_sign.setOnClickListener(new View.OnClickListener() {\r\n            @Override\r\n            public void onClick(View v) {\r\n                signIn();\r\n            }\r\n        });\r\n\r\n        login.setOnClickListener(new View.OnClickListener() {\r\n            @Override\r\n            public void onClick(View v) {\r\n                String uname_txt = username.getText().toString();\r\n                String pw_txt = password.getText().toString();\r\n\r\n                if (TextUtils.isEmpty(uname_txt) || TextUtils.isEmpty(pw_txt)) {\r\n                    Toast.makeText(LoginActivity.this, \"Please fill in your details\", Toast.LENGTH_SHORT).show();\r\n                } else {\r\n                    loginUser(uname_txt, pw_txt);\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n    private void loginUser(String username, String password) {\r\n        mAuth.signInWithEmailAndPassword(username, password).addOnCompleteListener(new OnCompleteListener<AuthResult>() {\r\n            @Override\r\n            public void onComplete(@NonNull Task<AuthResult> task) {\r\n                if (task.isSuccessful()) {\r\n                    Toast.makeText(LoginActivity.this, \"Welcome to Shroomies!\", Toast.LENGTH_SHORT).show();\r\n                    Intent intent = new Intent(LoginActivity.this, MainActivity.class);\r\n                    intent.addFlags(Intent.FLAG_ACTIVITY_CLEAR_TASK | Intent.FLAG_ACTIVITY_CLEAR_TOP);\r\n                    startActivity(intent);\r\n                    finish();\r\n                }\r\n            }\r\n        }).addOnFailureListener(new OnFailureListener() {\r\n            @Override\r\n            public void onFailure(@NonNull Exception e) {\r\n                if (e instanceof FirebaseAuthInvalidCredentialsException) {\r\n                    Toast.makeText(LoginActivity.this, \"Invalid password\", Toast.LENGTH_SHORT).show();\r\n                } else if (e instanceof FirebaseAuthInvalidUserException) {\r\n\r\n                    String errorCode =\r\n                            ((FirebaseAuthInvalidUserException) e).getErrorCode();\r\n\r\n                    if (errorCode.equals(\"ERROR_USER_NOT_FOUND\")) {\r\n                        Toast.makeText(LoginActivity.this, \"The email does not belong to a registered account. Please proceed to Sign Up.\", Toast.LENGTH_SHORT).show();\r\n                    } else if (errorCode.equals(\"ERROR_USER_DISABLED\")) {\r\n                        Toast.makeText(LoginActivity.this, \"User account has been disabled\", Toast.LENGTH_SHORT).show();\r\n                    } else {\r\n                        Toast.makeText(LoginActivity.this, e.getLocalizedMessage(), Toast.LENGTH_SHORT).show();\r\n                    }\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n    boolean setBiometric() {\r\n        executor = ContextCompat.getMainExecutor(this);\r\n        biometricPrompt = new BiometricPrompt(LoginActivity.this,\r\n                executor, new BiometricPrompt.AuthenticationCallback() {\r\n            @Override\r\n            public void onAuthenticationError(int errorCode,\r\n                                              @NonNull CharSequence errString) {\r\n                super.onAuthenticationError(errorCode, errString);\r\n                if (errorCode == BiometricConstants.ERROR_USER_CANCELED) {\r\n                    login.setOnTouchListener(null);\r\n                } else {\r\n                    Toast.makeText(getApplicationContext(),\r\n                            \"Authentication error: \" + errString, Toast.LENGTH_SHORT)\r\n                            .show();\r\n                }\r\n                successBiometric = false;\r\n            }\r\n\r\n            @Override\r\n            public void onAuthenticationSucceeded(\r\n                    @NonNull BiometricPrompt.AuthenticationResult result) {\r\n                super.onAuthenticationSucceeded(result);\r\n                successBiometric = true;\r\n            }\r\n\r\n            @Override\r\n            public void onAuthenticationFailed() {\r\n                super.onAuthenticationFailed();\r\n                Toast.makeText(getApplicationContext(), \"Authentication failed\",\r\n                        Toast.LENGTH_SHORT)\r\n                        .show();\r\n                successBiometric = false;\r\n            }\r\n        });\r\n\r\n        // Prompt appears when user clicks \"Log in\".\r\n        // Consider integrating with the keystore to unlock cryptographic operations,\r\n        // if needed by your app.\r\n        return successBiometric;\r\n    }\r\n\r\n    private void signIn() {\r\n        Intent signInIntent = mGoogleSignInClient.getSignInIntent();\r\n        startActivityForResult(signInIntent, RC_SIGN_IN);\r\n    }\r\n    public void onActivityResult(int requestCode, int resultCode, Intent data) {\r\n        super.onActivityResult(requestCode, resultCode, data);\r\n\r\n        if (requestCode == RC_SIGN_IN) {\r\n\r\n            Task<GoogleSignInAccount> task = GoogleSignIn.getSignedInAccountFromIntent(data);\r\n            try {\r\n                GoogleSignInAccount account = task.getResult(ApiException.class);\r\n\r\n                firebaseAuthWithGoogle(account);\r\n            } catch (ApiException e) {\r\n                Toast.makeText(LoginActivity.this, e.getMessage(), Toast.LENGTH_SHORT).show();\r\n            }\r\n        }\r\n    }\r\n    private void firebaseAuthWithGoogle(GoogleSignInAccount acct) {\r\n        Log.d(\"Login\",\"firebaseAuthWithGoogle:\" + acct.getId());\r\n\r\n        AuthCredential credential = GoogleAuthProvider.getCredential(acct.getIdToken(), null);\r\n\r\n        mAuth.signInWithCredential(credential).addOnCompleteListener(this, new OnCompleteListener<AuthResult>() {\r\n            @Override\r\n            public void onComplete(@NonNull Task<AuthResult> task) {\r\n                if (task.isSuccessful()){\r\n                    Log.d(\"Login\", \"signInWithCredential:Success\");\r\n                    FirebaseUser user = mAuth.getCurrentUser();\r\n\r\n                    Toast.makeText(LoginActivity.this, \"User Signed In\", Toast.LENGTH_SHORT).show();\r\n                }\r\n                else{\r\n                    Log.w(\"Login\", \"signInWithCredentail:Failure\", task.getException());\r\n                    Toast.makeText(LoginActivity.this, \"Authentication Failed\", Toast.LENGTH_SHORT).show();\r\n                }\r\n            }\r\n        });\r\n    }\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- app/src/main/java/com/example/shroomies/LoginActivity.java	(revision b5eed490fd6466253c4c7a3578131e1954620cbb)
+++ app/src/main/java/com/example/shroomies/LoginActivity.java	(date 1606748453604)
@@ -32,6 +32,8 @@
 import com.google.firebase.auth.FirebaseAuthInvalidUserException;
 import com.google.firebase.auth.FirebaseUser;
 import com.google.firebase.auth.GoogleAuthProvider;
+import com.google.firebase.auth.UserInfo;
+
 
 import java.io.File;
 import java.util.concurrent.Executor;
@@ -127,11 +129,17 @@
             @Override
             public void onComplete(@NonNull Task<AuthResult> task) {
                 if (task.isSuccessful()) {
-                    Toast.makeText(LoginActivity.this, "Welcome to Shroomies!", Toast.LENGTH_SHORT).show();
-                    Intent intent = new Intent(LoginActivity.this, MainActivity.class);
-                    intent.addFlags(Intent.FLAG_ACTIVITY_CLEAR_TASK | Intent.FLAG_ACTIVITY_CLEAR_TOP);
-                    startActivity(intent);
-                    finish();
+                    FirebaseUser muser = mAuth.getCurrentUser();
+                    if (muser != null) {
+                        for (UserInfo profile:muser.getProviderData()) {
+                            String name = profile.getDisplayName();
+                            Toast.makeText(LoginActivity.this, "Welcome to Shroomies!" + name, Toast.LENGTH_SHORT).show();
+                            Intent intent = new Intent(LoginActivity.this, MainActivity.class);
+                            intent.addFlags(Intent.FLAG_ACTIVITY_CLEAR_TASK | Intent.FLAG_ACTIVITY_CLEAR_TOP);
+                            startActivity(intent);
+                            finish();
+                        }
+                    }
                 }
             }
         }).addOnFailureListener(new OnFailureListener() {
@@ -229,9 +237,10 @@
                     FirebaseUser user = mAuth.getCurrentUser();
 
                     Toast.makeText(LoginActivity.this, "User Signed In", Toast.LENGTH_SHORT).show();
+                    startActivity(new Intent(LoginActivity.this, MainActivity.class));
                 }
                 else{
-                    Log.w("Login", "signInWithCredentail:Failure", task.getException());
+                    Log.w("Login", "signInWithCredential:Failure", task.getException());
                     Toast.makeText(LoginActivity.this, "Authentication Failed", Toast.LENGTH_SHORT).show();
                 }
             }
